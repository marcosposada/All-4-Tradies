<?php


class
MageB2B_Sublogin_Model_Sublogin
extends
Mage_Core_Model_Abstract
{
public
function
_construct()
{
parent::_construct();
$this->_init('sublogin/sublogin');
}
public
function
correctActive()
{
if
($this->getId()
&&
$this->getActive())
{

$_4c3915ba7f2eefececb7b5284323a4d06ec4fb0c
=
(int)
str_replace('-',
'',
$this->getExpireDate());
$_66f331ed08b8b8dd437d9dba5e4a732d7b2acabc
=
(int)date('Ymd');
if
($_66f331ed08b8b8dd437d9dba5e4a732d7b2acabc
>
$_4c3915ba7f2eefececb7b5284323a4d06ec4fb0c)
$this->setActive(false);
}
}
protected
function
_afterLoad()
{
$this->correctActive();
parent::_afterLoad();
}

protected
function
_beforeSave()
{
if
(!$this->getCustomerId())
{
$_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c
=
Mage::getModel('customer/customer')->load($this->getEntityId());
if
($_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c->getCustomerId())
{
$_b80cbfb11fdc80a0dabd8069a0fd063d9d896285
=
array();
$_205d95c001c842f933e3b55fa4e902d5d2fdd0af
=
Mage::getModel('sublogin/sublogin')->getCollection()->addFieldToFilter('entity_id',
$_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c->getId());
foreach
($_205d95c001c842f933e3b55fa4e902d5d2fdd0af
as
$_4e45fa4f3249d9c3cc1314ed89922593008cf117)
$_b80cbfb11fdc80a0dabd8069a0fd063d9d896285[]
=
$_4e45fa4f3249d9c3cc1314ed89922593008cf117->getCustomerId();
$_205d95c001c842f933e3b55fa4e902d5d2fdd0af
=
Mage::getModel('sublogin/sublogin')->getCollection()
->addFieldToFilter('entity_id',
$_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c->getId())
->addOrder('id',
'ASC');
$_e5063eb1568e4b8089f8c18b623e0363b782b74c=1;
while
(in_array($_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c->getCustomerId().'-'.$_e5063eb1568e4b8089f8c18b623e0363b782b74c,
$_b80cbfb11fdc80a0dabd8069a0fd063d9d896285))
$_e5063eb1568e4b8089f8c18b623e0363b782b74c++;
$this->setCustomerId($_b803c43bc8b3ef64b7d19b78f670cdbd11dacf8c->getCustomerId().'-'.$_e5063eb1568e4b8089f8c18b623e0363b782b74c);
}
}
parent::_beforeSave();
}
}
